!function(a){var b={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend"},c=document.createElement("div");for(var d in b)if("undefined"!=typeof c.style[d]){a.transitionEnd=b[d];break}a.transitionEnd||(a.transitionEnd=!1)}(window),function(a){"use strict";var b=a(window),c=a("html"),d=(a("body"),"abcdefghijklmnopqrstuvwxyz"),e=function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("safari")?a.indexOf("chrome")>-1?!1:!0:!1}(),f=navigator.userAgent.toLowerCase(),g=/safari|chrome/.test(f),h=(/android|blackBerry|iphone|ipad|ipod|opera mini|iemobile/i.test(f),/msie|trident.*rv\:11\./.test(f)),i=/firefox/.test(f),j=!1;c.addClass("ff-browser-"+(g?"webkit":h?"ie":i?"ff":"")),e&&c.addClass("safari"),a(function(){}),a(document).bind("html_ready ready",function(){function e(a){console.log("clear cache..."+a);var b=M.val(),c=!1;if(a&&!P){if(""!=b&&"all"!==a){b=b.split(",");for(var d=b.length;d--;)b[d]==a&&(c=!0);c||b.push(a)}else b=[a];M.val(b.join(","))}}function f(b,c){b.find(".ff-item").each(function(b,d){var e,f=a(d),g=f.find(".ff-img-holder");/[12]/.test(c)?(e=f.find(".ff-item-meta"),f.find(".ff-item-cont").prepend(e),g.length?f.addClass("ff-image"):("style-1"===c&&e.append(e.find(".ff-userpic")),f.addClass("ff-no-image"))):"style-3"===c&&f.prepend(f.find(".ff-icon")),f.addClass("ff-"+(g.length?"":"no-")+"image"),f.prepend(g)})}function g(b){b.find(".ff-item").each(function(b,c){var d=a(c),e=d.find(".ff-item-cont");e.append(e.find("h4")),e.append(e.find(".ff-img-holder")),e.append(e.find("p")),e.append(e.find(".ff-item-meta")),d.find(".ff-userpic").append(d.find(".ff-icon"))})}function h(){var b,c=[];a('.section-stream[data-view-mode="streams-update"], #streams-list').each(function(){c.push(a(this).outerHeight())}),b=Math.max.apply(Math,c),a(".section-content[data-tab=streams-tab]").css("minHeight",b)}function i(a){return a.charAt(0).toUpperCase()+a.slice(1)}function k(b,c){if(!E.find("#streams-update-"+b).length){var d,f,g,h,j,k,l,m,n,o,p,q,r=S["id"+b],s="",t="",u=!1;if(!r)return void(I="list");var v=A.view.replace(/%id%/g,b);if(r.feeds&&"[]"!==r.feeds)for(f=JSON.parse(r.feeds),o=0,p=f.length;p>o;o++){g=f[o],m="s"+b+"-f"+g.id,h="";for(var j in g)k=i(j.replace(" timeline","").replace("_"," ").replace("-"," ").replace("timeline ","")),l=g[j],"content"!==j&&(l=i(l)),"type"!==j&&"id"!==j&&"filter-by-words"!==j&&"avatar-url"!==j&&""!=l&&(l=l.replace("_"," ").replace(" timeline","").replace("http://","").replace("https://",""),l.length>20&&(l=l.substring(0,20)+"..."),h=h+"<span>"+k+':<span class="highlight">'+l+"</span></span>");s=s+'<tr data-uid="'+m+'" data-network="'+g.type+'"><td class="controls"><i class="flaticon-pen"></i> <i class="flaticon-copy"></i> <i class="flaticon-trash"></i></td><td class="td-feed"><i class="flaticon-'+g.type+'"></i>'+i(g.type)+'</td><td class="td-info">'+h+"</td></tr>",t+=A[g.type+"View"].replace(/\%uid\%/g,m)}else s='<tr><td  class="empty-cell" colspan="3">Add at least one feed</td></tr>',t="";v=v.replace("%LIST%",s).replace("%FEEDS%",t),q=a(v),E.find("#streams-cont").append(q),c?q.find("input[data-color-format]").ColorPickerSliders(T):q.on(window.transitionEnd,function(a){a.target!==a.currentTarget||u||(setTimeout(function(){q.find("input[data-color-format]").ColorPickerSliders(T)},0),q.off(window.transitionEnd),u=!0)});for(n in r)d=q.find('[name="stream-'+b+"-"+n+'"]'),d.is(":radio")||d.is(":checkbox")?d.each(function(){var b=a(this);b.attr("checked",b.val()==r[n])}):d.val(r[n]);if(f)for(o=0,p=f.length;p>o;o++){g=f[o],m="s"+r.id+"-f"+g.id;for(n in g)"id"!==n&&"type"!==n&&(d=q.find('[name="'+m+"-"+n+'"]'),d.is(":radio")||d.is(":checkbox")?d.each(function(){var b=a(this);b.val()==g[n]&&b.attr("checked",!0)}):d.val(g[n]))}q.find(".design-step-1").each(function(){var b,c=a(this),d=c.find(":checked");d.length&&(b=d.val(),c.closest(".section").addClass(b+"-layout-chosen"))}),q.find(".theme-choice input:checked, select[id*=cmeta], .style-choice select[id*=style], .design-step-2 select[id*=align], .layout-compact select[id*=compact-style]").change(),q.find(".design-step-2 [id*=width]").keyup(),q.delegate(".feed-view, .clearcache","change keyup",function(){e(b)})}}function l(a){var b=E.find("#streams-update-"+a);h(),F.removeClass("view-visible"),G.setItem("as_view_mode","update-"+a),setTimeout(function(){b.addClass("view-visible")},0)}function m(a){L.val(a||"nostream")}function n(){E.find("[id*=streams-update]").removeClass("view-visible"),F.addClass("view-visible"),G.setItem("as_view_mode","list")}function o(b){var c={},d=parseInt(b.find(".stream-id-value").val());return b.find(":input").each(function(){var b,e=a(this),f=e.attr("name"),g=e.val();if(-1!==f.indexOf("stream-"+d))if(f=f.replace("stream-"+d+"-",""),e.is(":radio"))e.is(":checked")&&(c[f]=e.val());else if(e.is(":checkbox"))c[f]=e.is(":checked")?e.val():"nope";else try{g=g.replace(/'/g,"'"),b=JSON.stringify(g),JSON.parse(b),c[f]=a.trim(g)}catch(h){}}),c}function p(b){var c=b.find("input:hidden"),d=[],e=b.find(".feed-view[data-feed-type]");e.each(function(){var b={},c=a(this),e=c.attr("data-uid"),f=c.data("fid")||e.replace(/s\d+?-f/,"");c.find(":input").each(function(){var c=a(this),d=c.attr("name");d=d.replace(/s\d+?\-f\w\w\d+?\-/,""),c.is(":radio")?c.is(":checked")&&(b[d]=c.val()):b[d]=c.is(":checkbox")?c.is(":checked")?a.trim(c.val()):"nope":a.trim(c.val())}),b.id=f?f:t(),b.type=c.attr("data-feed-type"),b["filter-by-words"]=c.next().find("input").val(),d.push(b)}),c.val(JSON.stringify(d))}function q(b){try{var c,d=a.extend({},S["id"+b]),b=O,e=a(A.view.replace(/%id%/g,b));if(E.find(' > [data-tab="streams-tab"]').append(e),delete d.id,d.feeds&&"[]"!==d.feeds){d.feeds=JSON.parse(d.feeds);for(var f=d.feeds.length;f--;)d.feeds[f].id=t();d.feeds=JSON.stringify(d.feeds)}for(var g in d)c=e.find("[name=stream-"+b+"-"+g+"]"),c.is(":radio")||c.is(":checkbox")?c.each(function(){var b=a(this);b.val()==d[g]&&b.attr("checked",!0)}):c.val(d[g]);e.find('input[name="stream-'+b+'-name"]').val(d.name+" copy"),O+=1}catch(h){alert("Error cloning stream")}}function r(){c.removeClass("popup_visible"),a("#fade-overlay").addClass("loading")}function s(a,b){for(var c="",d=a;d>0;--d)c+=b[Math.round(Math.random()*(b.length-1))];return c}function t(){return s(1,d)+s(1,d)+(new Date).getTime().toString().substr(8)}function u(a,b,c){if(a&&a.cssRules){for(var d=a.cssRules.length-1,e=d;e>0;e--){var f=a.cssRules[e];f.selectorText===b&&(c=f.style.cssText+c,a.deleteRule(e),d=e)}return a.insertRule?a.insertRule(b+"{"+c+"}",d):a.addRule(b,c,d),a.cssRules[d].cssText}}if(!j){j=!0;var v,w,x,y=a(".wrapper"),z=a("#flow_flow_form"),A=window.ff_templates,B=a(".section-tabs"),C=a("#streams-list"),D=B.find("li"),E=a(".section-contents"),F=a('.section-stream[data-view-mode="streams-list"]'),G=(a('.section-stream[data-view-mode="streams-update"]'),window.sessionStorage||{getItem:function(){},setItem:function(){}}),H=parseInt(G.getItem("as_active_tab")||0),I=G.getItem("as_view_mode")||"list",J=a("#fade-overlay"),K=a("#streams"),L=a("#lastSubmit"),M=a("#feedsChanged"),N=a("#streams-list tbody tr"),O=parseInt(N.last().attr("data-stream-id"),10)+1,P=!1,Q=N.length,R=0;isNaN(O)&&(Q=0,O=1),console.log(Q,O);var S=window.STREAMS||{},T={previewontriggerelement:!0,previewformat:"rgba",flat:!1,color:"rgb(255, 88, 115)",customswatches:"card_bg",swatches:["#c0392b","a3503c","925873","927758","589272","588c92","2bb1c0","2b8ac0","e96701","c02b74","000000","4C4C4C","CCCCCC","F0F0F0","FFFFFF"],order:{hsl:1,opacity:2,preview:3},onchange:function(b,c){var d=b.data("preview"),e=b.data("prop").replace(/-\d+/,""),f=d.find('[data-preview*="'+e+'"]'),g=b.data("input"),h=g.attr("data-prop"),i="";f.length&&("box-shadow"===h&&(i="0 1px 4px 0 "),f.each(function(){var b=a(this),d=c.tiny.toRgbString();b.css(b.attr("data-overrideProp")||h,i+d),"card-color"===e&&document.styleSheets&&b.is(".ff-icon")&&u(document.styleSheets[0],".ff-theme-classic.ff-style-2 .ff-icon:after","text-shadow: -1px 0 "+d+", 0 1px "+d+", 1px 0 "+d+", 0 -1px "+d+"!important;",R++)}))}};E.delegate("[id^=stream-name] .button-go-back","click",n),E.find("#streams-list .button-add").on("click",function(){var a;E.find(".dynamic-view").length||(isNaN(O)&&(O=1),a=A.view.replace(/%id%/g,O),a=a.replace("%LIST%",'<tr><td  class="empty-cell" colspan="3">Add at least one feed</td></tr>').replace("%FEEDS%",""),E.find(' > [data-tab="streams-tab"]').append(a),E.find("#streams-update-"+O).addClass("dynamic-view"),setTimeout(function(){E.find("input[data-color-format]").ColorPickerSliders(T)},400)),l(O)}),E.find("#streams-list .flaticon-copy").on("click",function(){var b=a(this),c=b.closest("[data-stream-id]").attr("data-stream-id");q(c),r(),setTimeout(function(){m(c),b.closest("form").submit()},100)}),E.find("#streams-list .flaticon-pen, #streams-list .td-name").on("click",function(){var b=a(this),c=b.closest("[data-stream-id]").attr("data-stream-id");k(c),l(c)}),E.find("#streams-list .flaticon-trash").on("click",function(){if(!confirm("Are you sure you want to permanatelly delete stream?"))return!1;var b=a(this),c=b.closest("[data-stream-id]").attr("data-stream-id");delete S["id"+c],K.val(JSON.stringify(S)),C.find("tbody tr").length||C.find("tbody").append('<tr><td class="empty-cell" colspan="4">Please add at least one stream</td></tr>'),r(),setTimeout(function(){m(c),b.closest("form").submit()},100)}),E.delegate("[id^=stream-feeds] .button-add","click",function(){var b=a(this),d=b.closest(".section"),e=d.find(".popup"),f=e.offset().top;e.addClass("add-feed-step-1"),c.addClass("popup_visible"),a("html, body").animate({scrollTop:f-50},300)}),E.delegate(".add-feed-step-2 .button-go-back","click",function(){var b=a(this),c=b.closest("[id^=stream-feeds]"),d=c.find(".popup"),e=d.offset().top;d.removeClass("add-feed-step-2").addClass("add-feed-step-1"),d.find(".feed-view-dynamic").remove(),a("html, body").animate({scrollTop:e-50},300)}),E.delegate("[id^=stream-feeds] .flaticon-pen, .td-feed","click",function(){var b=a(this),d=b.closest(".section"),e=b.closest("[data-uid]").attr("data-uid"),f=d.find(".popup"),g=f.offset().top;f.find(".feed-view-visible").removeClass("feed-view-visible"),f.find(".feed-view[data-uid="+e+"]").addClass("feed-view-visible"),f.addClass("add-feed-step-2"),f.find(".networks-content .feed-popup-controls.add").hide(),f.find(".networks-content .feed-popup-controls.edit").show(),c.addClass("popup_visible"),a("html, body").animate({scrollTop:g-50},300)}),E.delegate("[id^=stream-feeds] .flaticon-trash","click",function(){if(!confirm("Are you sure?"))return!1;var b=a(this),c=b.closest("[id^=streams-update]").find(".stream-id-value").val(),d=b.closest("[data-uid]").attr("data-uid"),f=b.closest(".section"),g=f.find(".popup"),h=g.find(".feed-view[data-uid="+d+"]");h.remove(),p(f),r(),e(c),setTimeout(function(){m(b.closest("[data-stream-id]").attr("data-stream-id")),b.closest("form").submit()},100)}),E.delegate("[id^=stream-feeds] .flaticon-copy","click",function(){var b=a(this),c=b.closest(".section"),d=c.find(".popup"),f=b.closest("[data-uid]"),g=f.attr("data-network"),h=c.attr("id").replace("stream-feeds-",""),i=t(),j=f.attr("data-uid"),k="s"+h+"-f"+i,l=d.find(".feed-view[data-uid="+j+"]"),n=a(A[g+"View"].replace(/\%uid\%/g,k)).data("fid",i);d.find(".networks-content .feed-popup-controls.add").before(n),n.find(":input").each(function(){var b=a(this),c=b.attr("name"),d=l.find('[name="'+c.replace(k,j)+'"]');d.is(":radio")||d.is(":checkbox")?d.each(function(){var c=a(this);c.is(":checked")&&c.attr("id").replace(j,k)==b.attr("id")&&b.attr("checked",!0)}):b.val(l.find('[name="'+c.replace(k,j)+'"]').val())}),p(c),r(),e(h),setTimeout(function(){m(h),b.closest("form").submit()},100)}),E.delegate(".popup .button-cancel-action, .popupclose","click",function(){c.removeClass("popup_visible"),a(this).closest("[id^=stream-feeds] .popup").length&&a("[id^=stream-feeds] .popup").removeClass("add-feed-step-1 add-feed-step-2").find(".feed-view-dynamic").remove()}),E.delegate(".networks-list > li","click",function(){var b=a(this),c=b.closest("[id^=stream-feeds]"),d=c.find(".popup"),e=b.attr("data-network"),f=c.attr("id").replace("stream-feeds-",""),g=t(),h="s"+f+"-f"+g,i=a(A[e+"View"].replace(/\%uid\%/g,h));d.find(".feed-view-visible").removeClass("feed-view-visible"),i.addClass("feed-view-visible feed-view-dynamic").data("fid",g),d.removeClass("add-feed-step-1").addClass("add-feed-step-2"),d.find(".networks-content .feed-popup-controls.edit").hide(),d.find(".networks-content .feed-popup-controls.add").show().before(i)}),E.delegate(".style-choice select[id*=style]","change",function(){var b=this.value,c=a(this).closest("dl").find(".preview .ff-stream-wrapper"),d=c.attr("class");/flat/.test(d)&&(g(c),f(c,b)),c.removeClass(function(){return d.match(/ff-style-[1-9]/)[0]}).addClass("ff-"+b)}),E.delegate(".layout-compact select[id*=compact-style]","change",function(){var b=this.value,c=a(this).closest("dl").find(".preview .ff-stream-wrapper"),d=c.attr("class");"c-style-1"===b?c.find(".ff-item-cont").append(c.find(".ff-item-meta")):"c-style-2"===b&&c.find(".ff-item-cont").after(c.find(".ff-item-meta")),c.removeClass(function(){return d.match(/ff-c-style-[1-9]/)[0]}).addClass("ff-"+b)}),E.delegate(".design-step-2 select[id*=align]","change",function(){var b=this.value,c=a(this).closest("dl").find(".preview .ff-stream-wrapper");c.css("text-align",b)}),E.delegate(".design-step-2 select[id*=cmeta]","change",function(){var b=this.value,c=a(this).closest("dl").find(".preview .ff-stream-wrapper");"upic"===b?c.addClass("ff-c-upic"):c.removeClass("ff-c-upic")}),E.delegate(".design-step-2 [id*=width]","keyup",function(){var b=this.value,c=a(this).closest(".design-step-2").find(".classic-style .preview, .flat-style .preview");b=parseInt(b),isNaN(b)||c.find(".ff-item").css("width",b+"px")}),J.click(function(){a(".section-stream.view-visible")&&a("[id^=stream-feeds] .popup").removeClass("add-feed-step-1 add-feed-step-2").find(".feed-view-dynamic").remove(),c.removeClass("popup_visible")}),D.on("click",function(){var b=D.index(this),c=a(this);return c.is("#request-tab")?void window.open("http://goo.gl/forms/HAJ95k8kAI"):(B.add(E).find(".active").removeClass("active"),c.add(E.find(".section-content:eq("+b+")")).addClass("active"),G.setItem("as_active_tab",b),!1)}),E.delegate("input","keydown",function(b){var c=a(this);c.is(".feed-view-visible input[name$=content]")&&c.removeClass("validation-error"),13==b.which}),E.delegate(".admin-button.submit-button","click",function(){var b,c,d=a(this);if(d.is("[id^=networks-sbmt]")){if(c=d.closest(".networks-content").find(".feed-view-visible"),c.find(":input").removeClass("validation-error"),b=c.find("input[name$=content]"),b.length&&!b.val())return setTimeout(function(){b.addClass("validation-error")},0),void a("html, body").animate({scrollTop:b.offset().top-150},300);p(d.closest("[id^=stream-feeds]"))}d.addClass("button-in-progress"),r(),setTimeout(function(){var a=d.closest("[id^=streams-update]").find(".stream-id-value").val();a||(a=d.is("#general-settings-sbmt")?"general":"auth"),m(a),d.closest("form").submit()},100),G.setItem("section-submit",a(this).attr("id"))}),b.unload(function(){G.setItem("as_scroll",a("body").scrollTop()||a("html").scrollTop())}),z.on("submit",function(){var b=E.find("[id^=streams-update]");b.each(function(){var b=a(this).find(".stream-id-value").val();S["id"+b]=o(a(this))}),K.val(JSON.stringify(S))}),E.delegate(".create_backup","click",function(){var b=E.find("[id^=streams-update]");b.each(function(){var b=a(this).find(".stream-id-value").val();S["id"+b]=o(a(this))}),K.val(JSON.stringify(S));var c={action:"create_backup",streams:JSON.stringify(S)};r(),a.post(_ajaxurl,c).done(function(){location.reload()})}),E.find(".restore_backup").click(function(){if(!confirm("Are you sure?"))return!1;var b={action:"restore_backup",id:a(this).closest("tr").attr("backup-id")};r(),a.post(_ajaxurl,b).done(function(){G.setItem("as_view_mode","list"),G.setItem("as_active_tab",0),location.reload()})}),E.find(".delete_backup").click(function(){if(!confirm("Are you sure?"))return!1;var b={action:"delete_backup",id:a(this).closest("tr").attr("backup-id")};r(),a.post(_ajaxurl,b).done(function(){location.reload()})}),v=new ZeroClipboard(a(".shortcode-copy")),v.on("copy",function(b){var c=a(b.target),d=b.clipboardData,e=a(b.target).parent().find(".shortcode").text();e?(c.addClass("copied").html("Copied"),d.setData("text/plain",e),setTimeout(function(){c.removeClass("copied").html("Copy to clipboard")},3e3)):c.addClass("copy-failed")}),x=G.getItem("as_scroll"),x&&(a("html, body").scrollTop(x),setTimeout(function(){a("html, body").scrollTop(x)},0)),a(".shortcode-copy").mouseleave(function(){a(this).removeClass("zeroclipboard-is-hover")}),a(".section-tabs li:eq("+H+"), .section-content:eq("+H+")").addClass("active"),I&&"list"!=I?k(I.replace("update-",""),!0):I="list",a(".section-stream#streams-"+I).addClass("view-visible"),h(),G.getItem("section-submit")&&(w=a("#"+G.getItem("section-submit")),setTimeout(function(){w.addClass("updated-button").html("✔&nbsp;&nbsp;Updated")},0),setTimeout(function(){w.html("Save changes").removeClass("updated-button")},2500)),G.setItem("section-submit",""),setTimeout(function(){y.css("opacity",1),a("#fade-overlay").removeClass("loading"),c.addClass("page-loaded")},0)}})}(jQuery);